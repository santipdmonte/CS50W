{% extends "auctions/layout.html" %}

{% block body %}
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'index' %}">Home</a></li>
            <li class="breadcrumb-item active"><a href="{% url 'category_page' listing.category.id %}">{{ listing.category }}</a></li>
            <li class="breadcrumb-item active"><a href="{% url 'listing_page' id=listing.id %}">{{ listing }}</a></li>
        </ol>
    </nav>
    <h2>Active Listings</h2>

    {% if user.id == listing.winner.id and listing.active == True %}
        <div class="alert alert-success" role="alert">
            You are winning the bid
        </div>
    {% elif user.id == listing.winner.id and  listing.active == False %}
        <div class="alert alert-success" role="alert">
            You the winner!!!
        </div>
    {% endif %}

    

    <div class="d-flex">
        <div class="card m-2" style="width: 18rem;">
            <img src="{{ listing.image_url }}" class="card-img-top" alt="...">
            <div class="card-body">
                <h5 class="card-title">{{ listing.title }}</h5>
                <p class="card-text">{{ listing.description }}</p>
                {% if listing.starting_bid == listing.actual_bid %}
                <p><b>Starting bid: </b>${{ listing.starting_bid }}</p>
                {% else %}
                <p><s>${{ listing.starting_bid }}</s></p> 
                <p><b>Current bid: </b>${{ listing.actual_bid }}</p>
                {% endif %}
            </div>
            </div>
    </div>

    {% if user.id == listing.owner.id and listing.active == True %}
        <form action="{% url 'listing_page' id=listing.id %}" method="post">
            {% csrf_token %}
            <input type="hidden" value="close_bid" name="type_form">
            <input type="submit" class="btn btn-danger" value="Close bid">
        </form>
    {% endif %}

    {% if user.is_authenticated%}

        {% if is_in_watchlist %}
            <form action="{% url 'listing_page' id=listing.id %}" method="post">
                {% csrf_token %}
                <input type="hidden" value="remove_watchlist" name="type_form">
                <input class="btn btn-secondary" type="submit" value="Remove to watchlist">
            </form>
        {% else %}  
            <form action="{% url 'listing_page' id=listing.id %}" method="post">
                {% csrf_token %}
                <input type="hidden" value="add_watchlist" name="type_form">
                <input class="btn btn-secondary" type="submit" value="Add from watchlist">
            </form>
        {%  endif %}

        <form action="{% url 'listing_page' id=listing.id %}" method="post">
            <!-- Validate all the inputs in server -->
            {% csrf_token %}
            <input type="hidden" value="new_bid" name="type_form">
            <input class="" type="number" value="" min="{{ listing.actual_bid }}" name="new_bid"> 
            <input type="submit" value="make bid">
        </form>
        <form action="{% url 'listing_page' id=listing.id %}" method="post">
            {% csrf_token %}
            <label for="">Comment: </label>
            <input type="hidden" value="new_comment" name="type_form">
            <input class="" type="text" placeholder="Comment..." name="new_comment"> 
            <input type="submit" value="Comment.">
        </form>
    {% endif %}   

    {% for comment in comments %}
        <p>{{ comment.commenter }}: {{ comment.comment }}</p>
    {% endfor %}

{% endblock %}